<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
            crossorigin="anonymous"
    />
    <title>Things To Do</title>
</head>
<body>
<%- include("nav.ejs") %>
<div class="container mt-4">
    <h3>일정 수정</h3>
    <form id="todo-form" action="/todos/<%= todo._id ;%>" method="put" data-id="<%= todo._id ;%>">
        <div class="form-group">
            <label>오늘의 할 일</label>
            <input id="todo-title" type="text" class="form-control" value="<%= todo.title ;%>" placeholder="오늘의 할 일"
                   name="title" />
        </div>
        <div class="form-group">
            <label>날짜</label>
            <input id="todo-date" type="text" class="form-control" value="<%= todo.date ;%>" placeholder="날짜"
                   name="date" />
        </div>
        <button id="todo-edit-button" class="btn btn-dark">업데이트</button>
    </form>
</div>
<script
        src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"
></script>
<script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"
></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"
></script>
<script>
  (() => {
    const todoForm = document.querySelector("#todo-form");
    const todoTitle = document.querySelector("#todo-title");
    const todoDate = document.querySelector("#todo-date");
    const editButton = document.querySelector("#todo-edit-button");

    const editTodo = () => {
      const todo = { title: todoTitle.value, date: todoDate.value };
      fetch(`/todos/${todoForm.dataset.id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(todo),
      }).then((res) => {
        if (res.ok) {
          location.href = "/todos";
        }
      });
    };

    const initialize = () => {
      editButton.addEventListener("click", (event) => {
        event.preventDefault();
        editTodo();
      });
    };

    initialize();
  })();
</script>
</body>
</html>
